<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Firewall Validation Error | Version 0.8</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./ts_cname_mismatch.html" />
    
    
    <link rel="prev" href="./ts_cli_argument_error.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="5.4"
        data-chapter-title="Firewall Validation Error"
        data-filepath="ts_firewall_error.md"
        data-basepath="."
        data-revision="Thu May 11 2017 09:49:00 GMT+0200 (W. Europe Daylight Time)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Version 0.8
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="introduction.html">
            
                
                    <a href="./introduction.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Overview of vSphere Integrated Containers Engine for vSphere Administrators
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="networks.html">
            
                
                    <a href="./networks.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Networks Used by vSphere Integrated Containers Engine
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="download_vic.html">
            
                
                    <a href="./download_vic.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Download vSphere Integrated Containers
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="contents_of_vic_binaries.html">
            
                
                    <a href="./contents_of_vic_binaries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Contents of the vSphere Integrated Containers Engine Binaries
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="deploy_vch.html">
            
                
                    <a href="./deploy_vch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Deploy VCHs
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="vic_installation_prereqs.html">
            
                
                    <a href="./vic_installation_prereqs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Environment Prerequisites for VCH Deployment
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="deploy_vch_esxi.html">
            
                
                    <a href="./deploy_vch_esxi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Deploy a VCH to an ESXi Host with No vCenter Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="deploy_vch_vcenter.html">
            
                
                    <a href="./deploy_vch_vcenter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Deploy a VCH to a Basic vCenter Server Cluster
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="verify_vch_deployment.html">
            
                
                    <a href="./verify_vch_deployment.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Verify the Deployment of a VCH
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="vch_installer_options.html">
            
                
                    <a href="./vch_installer_options.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        VCH Deployment Options
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="vch_installer_examples.html">
            
                
                    <a href="./vch_installer_examples.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Advanced Examples of Deploying a VCH
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="set_up_ops_user.html">
            
                
                    <a href="./set_up_ops_user.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        Use Different User Accounts for VCH Deployment and Operation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="deploy_vch_harbor.html">
            
                
                    <a href="./deploy_vch_harbor.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        Deploy a VCH with vSphere Integrated Containers Registry (Harbor)
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="install_vic_plugin.html">
            
                
                    <a href="./install_vic_plugin.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Installing the vSphere Web Client Plug-in
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="plugin_vc_web.html">
            
                
                    <a href="./plugin_vc_web.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        vCenter Server For Windows with a Web Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="plugin_vc_no_web.html">
            
                
                    <a href="./plugin_vc_no_web.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        vCenter Server for Windows without a Web Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="plugin_vcsa_web.html">
            
                
                    <a href="./plugin_vcsa_web.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        vCenter Server Appliance with a Web Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="plugin_vcsa_no_web.html">
            
                
                    <a href="./plugin_vcsa_no_web.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        vCenter Server Appliance without a Web Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="plugin_verify_deployment.html">
            
                
                    <a href="./plugin_verify_deployment.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Verify the Deployment of the Plug-In
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="troubleshoot_vic_install.html">
            
                
                    <a href="./troubleshoot_vic_install.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Troubleshooting vSphere Integrated Containers Engine Installation
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="ts_vch_deployment_timeout.html">
            
                
                    <a href="./ts_vch_deployment_timeout.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        VCH Deployment Times Out
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="ts_thumbprint_error.html">
            
                
                    <a href="./ts_thumbprint_error.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Certificate Verification Error
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="ts_cli_argument_error.html">
            
                
                    <a href="./ts_cli_argument_error.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Missing Common Name Error When TLS Options Are Specified
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="5.4" data-path="ts_firewall_error.html">
            
                
                    <a href="./ts_firewall_error.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Firewall Validation Error
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="ts_cname_mismatch.html">
            
                
                    <a href="./ts_cname_mismatch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Certificate cname Mismatch
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="ts_ui_not_appearing.html">
            
                
                    <a href="./ts_ui_not_appearing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Plug-In Does Not Appear in the vSphere Web Client
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="ts_docker_version_error.html">
            
                
                    <a href="./ts_docker_version_error.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        Docker API Version Error
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="ts_docker_api_check_error.html">
            
                
                    <a href="./ts_docker_api_check_error.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        I/O Timeout Error
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="feedback.html">
            
                
                    <a href="./feedback.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Send Documentation Feedback
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Version 0.8</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="vch-deployment-fails-with-firewall-validation-error">VCH Deployment Fails with Firewall Validation Error</h1>
<p>When you use <code>vic-machine create</code> to deploy a virtual container host (VCH), deployment fails because firewall port 2377 is not open on the target ESXi host or hosts.</p>
<h2 id="problem">Problem</h2>
<p>Deployment fails with a firewall error during the validation phase: </p>
<pre>Firewall must permit dst 2377/tcp outbound to the VCH management interface</pre>

<h2 id="cause">Cause</h2>
<p>ESXi hosts communicate with the VCHs through port 2377 via Serial Over LAN. For deployment of a VCH to succeed, port 2377 must be open for outgoing connections on all ESXi hosts before you run <code>vic-machine create</code>. Opening port 2377 for outgoing connections on ESXi hosts opens port 2377 for inbound connections on the VCHs.</p>
<h2 id="solution">Solution</h2>
<p>Set a firewall ruleset on the ESXi host or hosts. In test environments, you can disable the firewall on the hosts.</p>
<h3 id="set-a-firewall-ruleset-manually">Set a Firewall Ruleset Manually</h3>
<p>In production environments, if you are deploying to a standalone ESXi host, set a firewall ruleset on that ESXi host. If you are deploying to a cluster, set the firewall ruleset on all of the ESXi hosts in the cluster.</p>
<p><strong>IMPORTANT</strong>: Firewall rulesets that you set manually are not persistent. If you reboot the ESXi hosts, any firewall rules that you set are lost. You must recreate firewall rules each time you reboot a host.</p>
<ol>
<li>Use SSH to log in to each ESXi host as <code>root</code> user. </li>
<li>Follow the instructions in <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2008226" target="_blank">VMware KB 2008226</a> to add the following rule after the last rule in the file <code>/etc/vmware/firewall/service.xml</code>.<pre>
&lt;service id=&apos;<i>id_number</i>&apos;&gt;
&lt;id&gt;vicoutgoing&lt;/id&gt;
&lt;rule id=&apos;0000&apos;&gt;
 &lt;direction&gt;outbound&lt;/direction&gt;
 &lt;protocol&gt;tcp&lt;/protocol&gt;
 &lt;port type=&apos;dst&apos;&gt;2377&lt;/port&gt;
&lt;/rule&gt;
&lt;enabled&gt;true&lt;/enabled&gt;
&lt;required&gt;true&lt;/required&gt;
&lt;/service&gt;
</pre>


</li>
</ol>
<p>  In this example, <em>id_number</em> is the number of the preceding ruleset in <code>service.xml</code>, incremented by 1.</p>
<h3 id="disable-the-firewall">Disable the Firewall</h3>
<p>In test environments, you can disable the firewalls on the ESXi hosts instead of opening port 2377. </p>
<ol>
<li>Use SSH to log in to each ESXi host as <code>root</code> user. </li>
<li><p>Run the following command: </p>
<p><code>$ esxcli network firewall set --enabled false</code> </p>
</li>
</ol>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./ts_cli_argument_error.html" class="navigation navigation-prev " aria-label="Previous page: Missing Common Name Error When TLS Options Are Specified"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./ts_cname_mismatch.html" class="navigation navigation-next " aria-label="Next page: Certificate cname Mismatch"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
